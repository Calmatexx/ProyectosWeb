<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>‚ö° Generador de Sensibilidad NeoCibern√©tico ‚ö°</title>
  <meta name="description" content="Herramienta avanzada para calibrar sensibilidades de juego con IA y un estilo ne√≥n futurista." />
  <meta property="og:title" content="Generador de Sensibilidad NeoCibern√©tico" />
  <meta property="og:description" content="Optimiza tu experiencia de juego con ajustes personalizados y consejos de IA." />
  <meta name="theme-color" content="#00ffcc" />
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&family=Exo+2:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    :root { --bg-1:#000;--bg-2:#0d1b2a;--neon:#00ffcc;--mag:#ff00ff;--txt:#e0f7fa;--error:#ff0066;--ring:rgba(0,255,204,.55);--glass:rgba(10,27,42,.82);}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Exo 2',sans-serif;background:radial-gradient(circle,var(--bg-2),var(--bg-1));
      min-height:100vh;display:flex;flex-direction:column;align-items:center;color:var(--txt);overflow-y:auto;overflow-x:hidden;}
    #particles{position:fixed;inset:0;z-index:0;pointer-events:none}
    .wallpaper{position:fixed;inset:0;z-index:-2;background:url('https://cdn.pixabay.com/photo/2023/08/12/02/47/ai-generated-8184968_1280.jpg') center/cover no-repeat;opacity:.14}
    .gradient{position:fixed;inset:0;z-index:-1;background:linear-gradient(135deg,rgba(0,255,204,.18),rgba(255,0,255,.18));background-size:200% 200%}
    @keyframes flow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .gradient{animation:flow 14s ease-in-out infinite}
    @keyframes glow{from{text-shadow:0 0 8px var(--neon)}to{text-shadow:0 0 20px var(--mag)}}
    @keyframes glitch{0%,100%{transform:skewX(0deg)}20%{transform:skewX(-6deg)}40%{transform:skewX(4deg)}60%{transform:skewX(-2deg)}80%{transform:skewX(2deg)}}
    header{text-align:center;padding:2rem 1rem;position:relative;z-index:2}
    h1{font-family:'Orbitron',sans-serif;font-size:2.2rem;letter-spacing:.12em;color:var(--neon);
      text-shadow:0 0 16px var(--neon),0 0 28px var(--mag);animation:glow 2s infinite alternate,glitch 1s infinite;}
    .card{width:min(640px,92vw);background:var(--glass);backdrop-filter:blur(14px);border:2px solid var(--neon);border-radius:18px;
      box-shadow:0 0 36px rgba(0,255,204,.55),0 0 72px rgba(255,0,255,.35);padding:24px;margin:1rem 0 2rem;display:flex;flex-direction:column;gap:1.2rem;z-index:2}
    form{display:flex;flex-direction:column;gap:1rem}
    .row{display:grid;grid-template-columns:160px 1fr;gap:1rem;align-items:center}
    label{font-weight:700;color:var(--neon);text-shadow:0 0 6px var(--neon)}
    input,select{width:100%;padding:.9rem;border:2px solid var(--neon);border-radius:10px;background:rgba(0,27,42,.72);color:var(--txt);box-shadow:0 0 14px var(--ring);}
    input[type="range"]{-webkit-appearance:none;background:linear-gradient(90deg, var(--neon) 0%, var(--mag) 100%);height:8px;border-radius:5px;}
    input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:var(--neon);border:2px solid var(--mag);border-radius:50%;box-shadow:0 0 10px var(--ring);}
    .btn{background:linear-gradient(45deg,var(--neon),var(--mag));color:#fff;padding:.9rem 1.3rem;border:0;border-radius:12px;cursor:pointer;position:relative;overflow:hidden;}
    .btn::after{content:"";position:absolute;left:-50%;top:0;width:50%;height:100%;background:rgba(255,255,255,.3);transform:skewX(-20deg);transition:.5s;}
    .btn:hover::after{left:120%}
    .results{display:flex;flex-direction:column;gap:1.2rem;margin-top:1rem}
    .panel{background:rgba(10,27,42,.9);padding:1rem;border:2px solid var(--neon);border-radius:12px;box-shadow:0 0 18px rgba(0,255,204,.5)}
    .panel h2{font-family:'Orbitron',sans-serif;font-size:1.2rem;color:var(--neon);margin-bottom:.5rem}
    .glitch{color:var(--neon);font-weight:700;text-shadow:2px 2px var(--mag);animation:glitch 1s infinite}
    .errorBox{color:var(--error);background:rgba(60,20,60,.85);border:2px solid var(--error);padding:1rem;border-radius:12px;text-align:center}
    .copy-btn{background:linear-gradient(45deg,var(--mag),var(--neon));padding:.6rem 1rem;border-radius:8px;cursor:pointer;color:#fff;border:none;box-shadow:0 0 14px rgba(0,255,204,.6)}
    .copy-btn:hover{transform:translateY(-1px);box-shadow:0 0 20px rgba(255,0,255,.8)}
    #testCanvas{width:100%;height:300px;border:2px solid var(--neon);border-radius:12px;background:rgba(0,27,42,.9);touch-action:none;}
    #testInstructions{font-size:0.9rem;color:var(--txt);text-align:center;margin-top:0.5rem;}
    #musicControl{position:fixed;top:1rem;right:1rem;background:var(--glass);backdrop-filter:blur(14px);border:2px solid var(--neon);border-radius:10px;padding:.5rem;z-index:3;display:flex;flex-direction:column;gap:.5rem;opacity:1;transform:translateY(0);transition:opacity 0.3s ease, transform 0.3s ease;}
    #musicControl.hidden{display:none;opacity:0;transform:translateY(-10px);}
    #musicControl label{font-size:.9rem;color:var(--neon);text-shadow:0 0 6px var(--neon);margin-right:.5rem;}
    #musicControl select, #musicControl input[type="range"]{padding:.5rem;font-size:.9rem;}
    #musicToggleBtn{position:fixed;top:1rem;right:1rem;background:linear-gradient(45deg, var(--neon), var(--mag));border:2px solid var(--neon);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.2rem;cursor:pointer;box-shadow:0 0 14px var(--ring);z-index:3;display:none;}
    #musicToggleBtn:hover{transform:scale(1.1);box-shadow:0 0 20px rgba(255,0,255,.8);}
    @media (max-width:760px){.row{grid-template-columns:1fr}.card{padding:18px;width:min(520px,92vw)}h1{font-size:1.9rem}#musicControl,#musicToggleBtn{top:.5rem;right:.5rem;}}
  </style>
</head>
<body>
  <canvas id="particles"></canvas>
  <div class="wallpaper"></div>
  <div class="gradient"></div>

  <header><h1>‚ö° Generador NeoCibern√©tico ‚ö°</h1></header>

  <div id="musicControl">
    <div>
      <label for="music">M√∫sica</label>
      <select id="music">
        <option value="no" selected>No</option>
        <option value="yes">S√≠</option>
      </select>
    </div>
    <div>
      <label for="volume">Volumen</label>
      <input type="range" id="volume" min="0" max="1" step="0.1" value="0.5"/>
    </div>
  </div>
  <button id="musicToggleBtn">üéµ</button>

  <main>
    <section class="card">
      <form id="form">
        <div class="row">
          <label for="device">Modelo de Celular</label>
          <input id="device" list="deviceList" placeholder="Ej: Redmi Note 8" required/>
          <datalist id="deviceList">
            <option value="Samsung Galaxy S24 Ultra"></option>
            <option value="iPhone 15 Pro Max"></option>
            <option value="Google Pixel 8 Pro"></option>
            <option value="Xiaomi 14 Ultra"></option>
            <option value="Xiaomi Mi 11 Lite 5G"></option>
            <option value="Motorola Edge 50 Pro"></option>
            <option value="Motorola Moto G Stylus 5G 2024"></option>
            <option value="Redmi Note 13 Pro"></option>
            <option value="Redmi Note 12 5G"></option>
            <option value="Redmi Note 8"></option>
            <option value="Redmi Note 8 Pro"></option>
            <option value="Motorola Moto G60s"></option>
          </datalist>
        </div>

        <div class="row">
          <label for="sensitivityType">Protocolo</label>
          <select id="sensitivityType">
            <option value="aggressive">Sensi Alta (Mayor velocidad de movimiento)</option>
            <option value="precise">Sensi Precisa (M√°s control y estabilidad)</option>
            <option value="balanced" selected>Sensi Baja (Equilibrada)</option>
            <option value="custom">Personalizada</option>
          </select>
        </div>

        <div class="row">
          <label for="gameMode">Estrategia</label>
          <select id="gameMode">
            <option value="rusheo">Rush (agresivo)</option>
            <option value="soporte">Soporte (t√°ctico)</option>
            <option value="campeo">Campero (precisi√≥n)</option>
          </select>
        </div>

        <div class="row" id="dpiRow">
          <label for="includeDPI">Incluir DPI</label>
          <select id="includeDPI">
            <option value="yes">S√≠</option>
            <option value="no" selected>No</option>
          </select>
        </div>

        <button type="submit" class="btn">üöÄ Iniciar</button>
        <p id="errorBox" class="errorBox" hidden></p>
      </form>

      <section class="results">
        <div class="panel">
          <h2>Resultados</h2>
          <div id="sensitivityOut"></div>
          <button class="copy-btn" id="copyResults">Copiar Resultados</button>
        </div>
        <div class="panel">
          <h2>Probar Sensibilidad</h2>
          <canvas id="testCanvas"></canvas>
          <p id="testInstructions">Mueve el mouse o toca la pantalla para probar la sensibilidad adaptada a tu dispositivo.</p>
        </div>
        <div class="panel">
          <h2>IA Advisor</h2>
          <p id="advisorOut">Configura y pulsa iniciar.</p>
        </div>
      </section>
    </section>
  </main>

  <audio id="bgMusic" loop>
    <source src="Musica.mp3" type="audio/mpeg">
  </audio>

  <script>
    const $=s=>document.querySelector(s),rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a,clamp=(v,a,b)=>Math.max(a,Math.min(v,b));
    const form=$("#form"),device=$("#device"),typeSel=$("#sensitivityType"),modeSel=$("#gameMode"),dpiRow=$("#dpiRow"),dpiSel=$("#includeDPI"),musicSel=$("#music"),volumeSel=$("#volume"),out=$("#sensitivityOut"),advisor=$("#advisorOut"),err=$("#errorBox"),copyBtn=$("#copyResults"),bgMusic=$("#bgMusic"),musicControl=$("#musicControl"),musicToggleBtn=$("#musicToggleBtn");

    // Configuraci√≥n inicial del audio
    bgMusic.volume = 0.5; // Volumen inicial ajustado

    // Control de volumen
    volumeSel.addEventListener("input", () => {
      bgMusic.volume = parseFloat(volumeSel.value);
    });

    // Mostrar/ocultar panel de m√∫sica
    function toggleMusicControl(show) {
      musicControl.classList.toggle("hidden", !show);
      musicToggleBtn.style.display = show ? "none" : "flex";
    }

    // Ocultar al interactuar fuera del panel
    document.addEventListener("click", (e) => {
      if (!musicControl.contains(e.target) && !musicToggleBtn.contains(e.target)) {
        toggleMusicControl(false);
      }
    });
    document.addEventListener("touchstart", (e) => {
      if (!musicControl.contains(e.target) && !musicToggleBtn.contains(e.target)) {
        toggleMusicControl(false);
      }
    });

    // Mostrar panel al hacer clic en el bot√≥n
    musicToggleBtn.addEventListener("click", () => toggleMusicControl(true));
    musicToggleBtn.addEventListener("touchstart", () => toggleMusicControl(true));

    // Especificaciones reales de cada dispositivo (resoluci√≥n y tama√±o para calcular ppi aproximado)
    const deviceSpecs = {
      "Samsung Galaxy S24 Ultra": { width: 1440, height: 3120, size: 6.8, ppi: 505 },
      "iPhone 15 Pro Max": { width: 1290, height: 2796, size: 6.7, ppi: 460 },
      "Google Pixel 8 Pro": { width: 1344, height: 2992, size: 6.7, ppi: 489 },
      "Xiaomi 14 Ultra": { width: 1440, height: 3200, size: 6.73, ppi: 522 },
      "Xiaomi Mi 11 Lite 5G": { width: 1080, height: 2400, size: 6.55, ppi: 402 },
      "Motorola Edge 50 Pro": { width: 1220, height: 2712, size: 6.7, ppi: 446 },
      "Motorola Moto G Stylus 5G 2024": { width: 1080, height: 2400, size: 6.7, ppi: 395 },
      "Redmi Note 13 Pro": { width: 1220, height: 2712, size: 6.67, ppi: 446 },
      "Redmi Note 12 5G": { width: 1080, height: 2400, size: 6.67, ppi: 395 },
      "Redmi Note 8": { width: 1080, height: 2340, size: 6.3, ppi: 409 },
      "Redmi Note 8 Pro": { width: 1080, height: 2340, size: 6.53, ppi: 395 },
      "Motorola Moto G60s": { width: 1080, height: 2460, size: 6.8, ppi: 395 }
    };

    // Factor de adaptaci√≥n por dispositivo
    function getDeviceFactor(dev) {
      const specs = deviceSpecs[dev] || { ppi: 400 }; // Default neutral
      const basePpi = 400; // Referencia base
      let factor = (specs.ppi / basePpi) * (specs.size / 6.5); // Escala por ppi y tama√±o
      if (dev.toLowerCase().includes("iphone")) factor *= 0.75; // Reducci√≥n para iOS
      return clamp(factor, 0.85, 1.15); // Capado para evitar extremos
    }

    const isIPhone=()=>device.value.toLowerCase().includes("iphone");

    // Rangos base ajustados: altos sin DPI, m√°s bajos con DPI
    const baseRangesNoDPI = {
      aggressive: {general:[150,200], redDot:[140,180], s2x:[145,190], s4x:[135,175], awm:[90,130], cam:[35,50]},
      precise: {general:[100,140], redDot:[90,130], s2x:[100,140], s4x:[90,130], awm:[80,120], cam:[30,45]},
      balanced: {general:[100,130], redDot:[90,120], s2x:[100,130], s4x:[90,120], awm:[70,100], cam:[25,40]},
      custom: {general:[0,200], redDot:[0,200], s2x:[0,200], s4x:[0,200], awm:[0,200], cam:[0,50]}
    };

    const baseRangesWithDPI = {
      aggressive: {general:[100,140], redDot:[90,130], s2x:[100,140], s4x:[90,130], awm:[70,100], cam:[25,40]},
      precise: {general:[70,100], redDot:[60,90], s2x:[70,100], s4x:[60,90], awm:[60,90], cam:[20,35]},
      balanced: {general:[70,100], redDot:[60,90], s2x:[70,100], s4x:[60,90], awm:[50,80], cam:[20,35]},
      custom: {general:[0,200], redDot:[0,200], s2x:[0,200], s4x:[0,200], awm:[0,200], cam:[0,50]}
    };

    // Generar rangos adaptados din√°micamente
    const ranges = {};
    function updateRanges(dev, useDPI) {
      const factor = getDeviceFactor(dev);
      const baseRanges = useDPI ? baseRangesWithDPI : baseRangesNoDPI;
      for (let type in baseRanges) {
        ranges[type] = {};
        for (let scope in baseRanges[type]) {
          let [min, max] = baseRanges[type][scope];
          min = Math.round(min * factor);
          max = Math.round(max * factor);
          ranges[type][scope] = [clamp(min, 0, scope === 'cam' ? 50 : 200), clamp(max, 0, scope === 'cam' ? 50 : 200)];
        }
      }
    }

    const autoFire=(mode)=>{let v=rand(40,55);if(mode==="rusheo")v+=3;if(mode==="campeo")v-=2;return clamp(v,39,60);};

    // DPI adaptado: 400-700 low, 600-900 high
    const autoDPI=(type,mode,dev)=>{
      let base;
      if(type==="aggressive") base=rand(600,900);
      else if(type==="precise") base=rand(400,600);
      else base=rand(450,700);
      if(mode==="rusheo") base+=30;
      if(mode==="campeo") base-=20;
      const factor = getDeviceFactor(dev);
      base = Math.round(base * factor);
      return clamp(base,400,900);
    };

    // Ocultar DPI en iPhone
    function updateDPIVisibility(){
      dpiRow.style.display = isIPhone() ? "none" : "grid";
    }
    device.addEventListener("input", updateDPIVisibility);
    device.addEventListener("change", (e) => {
      updateDPIVisibility();
      updateRanges(e.target.value, dpiSel.value === "yes"); // Actualizar rangos al cambiar dispositivo
    });
    updateDPIVisibility();
    updateRanges("", false); // Inicial sin DPI

    // Control de m√∫sica
    function updateMusic() {
      if (musicSel.value === "yes") {
        bgMusic.play().catch(e => console.log("Error al reproducir m√∫sica:", e));
      } else {
        bgMusic.pause();
      }
    }
    musicSel.addEventListener("change", updateMusic);

    // IA Advisor din√°mico con menci√≥n a DPI y m√∫sica
    function getAdvisor(type, mode, dev, useDPI){
      let msg = "";
      if(type==="aggressive") msg = "‚ö° Sensi Alta: ideal para reflejos r√°pidos y headshots en rush.";
      if(type==="precise") msg = "üéØ Sensi Precisa: perfecta para control y estabilidad en tiros lejanos.";
      if(type==="balanced") msg = "‚öñÔ∏è Sensi Baja: equilibrio entre velocidad y precisi√≥n, ideal para todo.";
      if(type==="custom") msg = "üõ†Ô∏è Personalizada: ajusta manualmente en entrenamiento para headshots.";

      if(mode==="rusheo") msg += " üèÉ Recomendada para combates cercanos y ataques r√°pidos.";
      if(mode==="soporte") msg += " üõ°Ô∏è √ösala para cobertura y precisi√≥n en medio alcance.";
      if(mode==="campeo") msg += " üî≠ Potencia la precisi√≥n en largas distancias con AWM.";

      const specs = deviceSpecs[dev] || {};
      if (specs.ppi) {
        if (isIPhone()) msg += ` üì± Optimizado para ${dev} (${specs.size}" ${specs.ppi}ppi): sensibilidades reducidas para precisi√≥n t√°ctil.`;
        else msg += ` üì± Optimizado para ${dev} (${specs.size}" ${specs.ppi}ppi): sensibilidades ajustadas para headshots fluidos.`;
      }
      if (useDPI && !isIPhone()) msg += " üîß DPI activado: sensibilidades m√°s bajas para aprovechar la mayor precisi√≥n.";
      if (musicSel.value === "yes") msg += ` üéµ M√∫sica activada: volumen al ${Math.round(bgMusic.volume * 100)}% para mantener el ritmo cyberpunk.`;

      return msg;
    }

    // Configuraci√≥n del canvas de prueba
    const testCanvas = $("#testCanvas");
    const testCtx = testCanvas.getContext("2d");
    testCanvas.width = testCanvas.offsetWidth;
    testCanvas.height = testCanvas.offsetHeight;

    // Variables para el punto
    let point = { x: testCanvas.width / 2, y: testCanvas.height / 2 };
    let sensitivity = 1;

    // Funci√≥n para dibujar el punto
    function drawPoint() {
      testCtx.clearRect(0, 0, testCanvas.width, testCanvas.height);
      testCtx.beginPath();
      testCtx.arc(point.x, point.y, 10, 0, Math.PI * 2);
      testCtx.fillStyle = "var(--neon)";
      testCtx.shadowColor = "var(--neon)";
      testCtx.shadowBlur = 15;
      testCtx.fill();
    }

    // Funci√≥n para manejar el movimiento del mouse/tacto
    function movePoint(event) {
      event.preventDefault();
      const rect = testCanvas.getBoundingClientRect();
      let clientX, clientY;

      if (event.type === "mousemove") {
        clientX = event.clientX;
        clientY = event.clientY;
      } else if (event.type === "touchmove") {
        clientX = event.touches[0].clientX;
        clientY = event.touches[0].clientY;
      }

      const mouseX = clientX - rect.left;
      const mouseY = clientY - rect.top;

      const deltaX = (mouseX - point.x) * (sensitivity / 100);
      const deltaY = (mouseY - point.y) * (sensitivity / 100);

      point.x = clamp(point.x + deltaX, 0, testCanvas.width);
      point.y = clamp(point.y + deltaY, 0, testCanvas.height);

      drawPoint();
    }

    testCanvas.addEventListener("mousemove", movePoint);
    testCanvas.addEventListener("touchmove", movePoint);

    // Formulario de sensibilidad
    form.addEventListener("submit", e=>{
      e.preventDefault();
      err.hidden=true;
      out.innerHTML="";
      advisor.innerHTML="";
      const dev=device.value.trim();
      if(!dev){
        err.hidden=false;
        err.textContent="‚ùå Ingresa un modelo v√°lido.";
        return;
      }
      const useDPI = dpiSel.value === "yes" && !isIPhone();
      updateRanges(dev, useDPI); // Actualizar rangos seg√∫n DPI
      const type=typeSel.value,mode=modeSel.value;
      const r=ranges[type]||ranges.balanced;

      let vals={
        general:rand(...r.general),
        redDot:rand(...r.redDot),
        s2x:rand(...r.s2x),
        s4x:rand(...r.s4x),
        awm:rand(...r.awm),
        cam:rand(...r.cam),
        fire:autoFire(mode)
      };

      if(mode==="rusheo"){
        vals.general+=10;
        vals.redDot+=8;
        vals.fire+=2;
      }
      if(mode==="soporte"){
        vals.cam+=8;
        vals.s2x+=5;
        vals.s4x+=5;
      }
      if(mode==="campeo"){
        vals.awm+=10;
        vals.s4x+=8;
        vals.redDot-=5;
      }

      for(let k in vals){
        vals[k]=clamp(vals[k],k==="fire"?39:0,k==="fire"?60:200);
      }

      // Actualizar sensibilidad para el canvas
      sensitivity = vals.general;

      let dpiTxt="";
      if(useDPI){
        dpiTxt=`<p>DPI: <span class="glitch">${autoDPI(type,mode,dev)}</span> (adaptado a ${deviceSpecs[dev]?.ppi || 'tu'} ppi)</p>`;
      }

      out.innerHTML=`
        <p class="glitch">üì± ${dev} (Adaptado a ${deviceSpecs[dev]?.ppi || 'resoluci√≥n'})</p>
        <p>General: <span class="glitch">${vals.general}</span></p>
        <p>Punto Rojo: <span class="glitch">${vals.redDot}</span></p>
        <p>Mira x2: <span class="glitch">${vals.s2x}</span></p>
        <p>Mira x4: <span class="glitch">${vals.s4x}</span></p>
        <p>AWM: <span class="glitch">${vals.awm}</span></p>
        <p>C√°mara: <span class="glitch">${vals.cam}</span></p>
        <p>Bot√≥n Disparo: <span class="glitch">${vals.fire}</span></p>
        ${dpiTxt}
      `;

      advisor.innerHTML="ü§ñ Consejo IA: " + getAdvisor(type, mode, dev, useDPI);

      // Controlar m√∫sica al enviar
      updateMusic();

      drawPoint();
    });

    // Copiar resultados
    copyBtn.addEventListener("click",()=>{
      navigator.clipboard.writeText(out.innerText)
        .then(()=>{copyBtn.textContent="¬°Copiado!";setTimeout(()=>copyBtn.textContent="Copiar Resultados",2000);});
    });

    // Redimensionar canvas
    window.addEventListener("resize", () => {
      testCanvas.width = testCanvas.offsetWidth;
      testCanvas.height = testCanvas.offsetHeight;
      point.x = testCanvas.width / 2;
      point.y = testCanvas.height / 2;
      drawPoint();
    });

    // Part√≠culas de fondo
    const canvas=$("#particles"),ctx=canvas.getContext("2d");
    canvas.width=innerWidth;
    canvas.height=innerHeight;
    const parts=Array.from({length:100},()=>({x:rand(0,innerWidth),y:rand(0,innerHeight),r:rand(1,3),dx:rand(-1,1),dy:rand(-1,1)}));
    (function anim(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="rgba(0,255,204,0.7)";
      parts.forEach(p=>{
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fill();
        p.x+=p.dx;
        p.y+=p.dy;
        if(p.x<0||p.x>canvas.width)p.dx*=-1;
        if(p.y<0||p.y>canvas.height)p.dy*=-1;
      });
      requestAnimationFrame(anim);
    })();
  </script>
</body>
</html>